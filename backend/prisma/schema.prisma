generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             Int      @id @default(autoincrement())
  username       String   @unique
  password       String
  createdAt      DateTime @default(now())
  role           String
  secretPassword String   @default("DEFAULTSECRET")
}

model Call {
  id             Int       @id @default(autoincrement())
  problem        String
  category       String
  status         String
  assignedTo     String?
  assignedAt     DateTime?
  createdBy      String
  createdAt      DateTime  @default(now())
  completedBy    String?
  completedAt    DateTime?
  customerId     Int?
  address        String?
  customerName   String
  email          String?
  phone          String
  remark         String?
  engineerRemark String?
  assignedBy     String?
  callCount      Int       @default(1)
  lastCalledAt   DateTime  @default(now())
  customer       Customer? @relation(fields: [customerId], references: [id])

  @@index([assignedTo])
  @@index([createdBy])
  @@index([phone, category, status])
}

model Customer {
  id           Int       @id @default(autoincrement())
  email        String?
  address      String?
  name         String
  phone        String    @unique
  createdAt    DateTime  @default(now())
  lastCallDate DateTime?
  totalCalls   Int       @default(0)
  calls        Call[]
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    String
  message   String
  type      String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  callId    Int?

  @@index([userId, isRead])
}

model Category {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ServiceCategory {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CarryInCustomer {
  id        Int              @id @default(autoincrement())
  name      String
  phone     String           @unique
  email     String?
  address   String?
  createdAt DateTime         @default(now())
  services  CarryInService[]
}

model CarryInService {
  id                 Int              @id @default(autoincrement())
  customerName       String
  phone              String
  email              String?
  address            String?
  category           String
  serviceDescription String?
  status             String           @default("PENDING")
  customerId         Int?
  createdBy          String
  createdAt          DateTime         @default(now())
  completedBy        String?
  completedAt        DateTime?
  deliveredBy        String?
  deliveredAt        DateTime?
  customer           CarryInCustomer? @relation(fields: [customerId], references: [id])

  @@index([phone])
  @@index([status])
  @@index([createdBy])
}
